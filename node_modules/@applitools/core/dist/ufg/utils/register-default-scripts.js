"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.registerDefaultScripts = void 0;
const capture_canvas_image_always_1 = require("../../utils/capture-canvas-image-always");
const utils_1 = require("@applitools/utils");
function wrapFunctionAsIIFE(fn) {
    return `(()=>{ ${fn.toString()} return ${fn.name}.call()})()`;
}
async function registerDefaultScripts({ driver, logger, }) {
    if (!driver)
        return [];
    try {
        const captureImagesScript = wrapFunctionAsIIFE(capture_canvas_image_always_1.captureImagesFunc);
        const scripts = [];
        if (utils_1.general.getEnvValue('CAPTURE_CANVAS_WITH_WEBGL', 'boolean') === true) {
            scripts.push({ name: 'captureImagesScript', code: captureImagesScript });
        }
        await Promise.all(scripts.map(async (script) => {
            logger.info('running user script', script.name);
            await driver.addScriptToEvaluateOnNewDocument(script.code);
        }));
        return scripts;
    }
    catch (error) {
        logger.error(error);
        return [];
    }
}
exports.registerDefaultScripts = registerDefaultScripts;
